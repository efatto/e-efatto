<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="mail_activity_view_form_popup_timeline" model="ir.ui.view">
        <field name="name">mail.activity.view.form.popup.timeline</field>
        <field name="model">mail.activity</field>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <form string="Log an Activity" create="false">
                <sheet string="Activity">
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                        </button>
                        <button name="action_activity_duplicate" type="object" class="oe_stat_button" icon="fa-copy" string="Duplicate"></button>
                    </div>
                    <group invisible="1">
                        <field name="activity_category" invisible="1" />
                        <field name="res_model" invisible="1"/>
                        <field name="res_model_id" invisible="1"/>
                        <field name="res_id" invisible="1"/>
                        <field name="force_next" invisible="1"/>
                        <field name="previous_activity_type_id"/>
                        <field name="has_recommended_activities"/>
                    </group>
                    <group attrs="{'invisible': [('has_recommended_activities','=',False)]}">
                        <div class="o_row">
                            <strong>Recommended Activities</strong>
                            <field name="recommended_activity_type_id" widget="selection_badge"
                                domain="[('previous_type_ids', '=', previous_activity_type_id)]"
                                nolabel="1"/>
                        </div>
                    </group>
                    <group>
                        <group>
                            <field name="activity_type_id" required="1" options="{'no_create': True, 'no_open': True}"/>
                            <field name="summary" placeholder="e.g. Discuss proposal"/>
                        </group>
                        <group>
                            <field name="date_deadline"/>
                            <field name="date_start"/>
                            <field name="date_end"/>
                            <field name="color_active"/>
                            <field name="parent_id"/>
                            <field name="workcenter_id"/>
                            <field name="user_id"/>
                        </group>
                    </group>
                    <group colspan="4" col="1">
                        <button name="open_origin" type="object" class="oe_highlight">
                            <field name="res_name"/>
                        </button>
                    </group>
                    <field name="note" placeholder="Log a note..."/>
                    <footer>
                        <button string="Schedule" name="action_close_dialog"
                            type="object" class="btn-primary"/>
                        <button attrs="{'invisible': [('force_next', '=', True)]}" string="Mark as Done" name="action_done"
                            type="object" class="btn-secondary"
                            context="{'mail_activity_quick_update': True}"/>
                        <button attrs="{'invisible': [('force_next', '=', True)]}" string="Done &amp; Schedule Next" name="action_done_schedule_next"
                            type="object" class="btn-secondary"
                            context="{'mail_activity_quick_update': True}"/>
                        <button attrs="{'invisible': [('force_next', '=', False)]}" string="Done &amp; Launch Next" name="action_done_schedule_next"
                            type="object" class="btn-secondary"
                            context="{'mail_activity_quick_update': True}"/>
                        <button string="Discard" class="btn-secondary" special="cancel" />
                    </footer>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="mail_activity_type_view_form">
        <field name="name">mail.activity.type.form</field>
        <field name="model">mail.activity.type</field>
        <field name="inherit_id" ref="mail.mail_activity_type_view_form"/>
        <field name="arch" type="xml">
            <field name="force_next" position="before">
                <field name="is_resource_planner"/>
            </field>
        </field>
    </record>

    <record id="mail_activity_view_calendar_list" model="ir.ui.view">
        <field name="name">mail.activity.view.calendar</field>
        <field name="model">mail.activity</field>
        <field name="priority" eval="2"/>
        <field name="arch" type="xml">
            <calendar_list string="Activity" date_start="date_deadline" color="activity_type_id">
                <field name="res_name"/>
                <field name="user_id"/>
                <field name="summary"/>
            </calendar_list>
        </field>
    </record>

    <record model="ir.ui.view" id="mail_activity_view_form_board">
        <field name="name">mail.activity.boards.view.form</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail_activity_board.mail_activity_view_form_board"/>
        <field name="arch" type="xml">
            <field name="date_deadline" position="before">
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="parent_id"/>
            </field>
        </field>
    </record>

    <record id="mail_activity_timeline" model="ir.ui.view">
        <field name="model">mail.activity</field>
        <field name="type">timeline</field>
        <field name="arch" type="xml">
            <timeline date_start="date_start"
                      date_stop="date_end"
                      default_group_by="workcenter_id"
                      event_open_popup="%(mail_activity_timeline.mail_activity_view_form_popup_timeline)s"
                      mode="week"
                      color_field="color_active"
                      dependency_arrow="parent_id">
                <field name="user_id"/>
                <field name="color_active"/>
                <field name="is_resource_planner"/>
                <field name="res_name"/>
                <field name="workcenter_id"/>
                <templates>
                    <t t-name="timeline-item">
                        <div>
                            <img t-if="record.user_id"
                                 t-attf-src="/web/image/res.users/#{record.user_id[0]}/image/24x24"
                                 t-att-title="record.user_id[1]" width="24" height="24" class="mr8"/>
                            <span name="res_name">
                                <t t-esc="record.res_name"/>
                            </span>
                        </div>
                    </t>
                </templates>
            </timeline>
        </field>
    </record>

    <record id="mail_activity_view_search" model="ir.ui.view">
        <field name="name">mail.activity.boards.view.search</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_search"/>
        <field name="arch" type="xml">
            <xpath expr='//filter[@name="activities_my"]' position='after'>
                <filter string="All" name="activities_all"
                        domain="['|', ('active', '!=', True), ('active', '=', True)]"
                        help="Show all activities."/>
            </xpath>
            <field name="summary" position="before">
                <field name="res_name"/>
            </field>
        </field>
    </record>

    <record id="mail_activity_view_tree" model="ir.ui.view">
        <field name="name">mail.activity.boards.view.tree</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_tree"/>
        <field name="arch" type="xml">
            <field name="res_name" position="after">
                <field name="active" invisible="1"/>
            </field>
            <xpath expr="//tree" position="attributes">
                <attribute name="default_order"/>
                <attribute name="decoration-muted">(not active)</attribute>
                <attribute name="decoration-danger">(active and date_deadline &lt; current_date)</attribute>
                <attribute name="decoration-warning">(active and date_deadline == current_date)</attribute>
                <attribute name="decoration-success">(active and date_deadline &gt; current_date)</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.actions.act_window" id="resource_planner_activities">
        <field name="name">Resource Planner Activities</field>
        <field name="res_model">mail.activity</field>
        <field name="view_type">form</field>
        <field name="view_mode">timeline,kanban,tree,form</field>
        <field name="domain">[('is_resource_planner', '=', True)]</field>
        <field name="context">{'search_default_activities_all': 1}</field>
        <field name="view_ids" eval="[(5, 0, 0)]"/>
        <field name="search_view_id" ref="mail_activity_board.mail_activity_view_search"/>
    </record>

    <menuitem
        id="mail_menu_planner"
        name="Resource Planner"
        sequence="3"
        action="resource_planner_activities"
        web_icon="mail_activity_timeline,static/description/icon.png"
        groups="base.group_user"/>

</odoo>
